"use strict";(self.webpackChunkrubic=self.webpackChunkrubic||[]).push([[76],{67532:(x,P,t)=>{t.d(P,{r:()=>$});var v=t(74523),A=t(31635),f=t(17705),S=t(68247),s=t(55748),g=t(89417);const e=[s.BLOCKCHAIN_NAME.ETHEREUM,s.BLOCKCHAIN_NAME.BINANCE_SMART_CHAIN,s.BLOCKCHAIN_NAME.POLYGON,s.BLOCKCHAIN_NAME.ARBITRUM,s.BLOCKCHAIN_NAME.OPTIMISM,s.BLOCKCHAIN_NAME.AVALANCHE,s.BLOCKCHAIN_NAME.FANTOM];var n=t(84412),r=t(99172),C=t(44668),M=t(20140),b=t(25558),B=t(96354),T=t(7673),K=t(27468),R=t(71985),H=t(16094),l=t(87919),G=t(73193),o=t(93802),p=t(93359),O=t(409),k=t(5964),F=t(23294),V=t(88141),Q=t(97647),J=t(61594),Y=t(99437),U=t(70152),Z=t(35763),X=t(88368),_=t(95917),q=t(59925),tt=t(21626),et=t(16123),st=t(73955);class ${set tableLoading(i){this._tableLoading$.next(i)}set tokenSearchQuery(i){this.queryForm.controls.token.patchValue(i)}set spenderSearchQuery(i){this.queryForm.controls.spender.patchValue(i)}set size(i){this._size$.next(i)}set page(i){this._page$.next(i)}constructor(i,c,h,d,a,m,E,y){this.walletConnectorService=i,this.httpService=c,this.injector=h,this.tokensService=d,this.tokensStoreService=a,this.notificationsService=m,this.translateService=E,this.gasService=y,this._exceededLimits$=new n.t(!1),this.exceededLimits$=this._exceededLimits$.asObservable(),this.supportedBlockchains=Object.entries(S.i).filter(([u])=>e.includes(u)).map(([u,I])=>I),this.defaultBlockchain=this.supportedBlockchains.find(u=>u.key===(this.walletConnectorService.network??s.BLOCKCHAIN_NAME.ETHEREUM))??S.i.ETH,this.form=new g.gE({blockchain:new g.MJ(this.defaultBlockchain)}),this.queryForm=new g.gE({spender:new g.MJ(""),token:new g.MJ("")}),this.selectedBlockchain$=this.form.controls.blockchain.valueChanges.pipe((0,r.Z)(this.form.controls.blockchain.value),(0,C.t)(o.V)),this._refreshTable$=new n.t(""),this.refreshTable$=this._refreshTable$.asObservable(),this.allApproves$=this.selectedBlockchain$.pipe((0,r.Z)(this.defaultBlockchain),(0,M.v)(this.walletConnectorService.addressChange$.pipe((0,k.p)(u=>null!==u)),this.refreshTable$),(0,F.F)(),(0,V.M)(()=>{this.tableLoading=!0,this.page=0,this.tokenSearchQuery="",this.spenderSearchQuery=""}),(0,b.n)(([u,I,L])=>this.fetchTransactions(u,I,L)),(0,V.M)(()=>this.tableLoading=!1)),this._tableLoading$=new n.t(!0),this.tableLoading$=this._tableLoading$.asObservable(),this._size$=new n.t(10),this.size$=this._size$.asObservable(),this._page$=new n.t(0),this.page$=this._page$.asObservable(),this.visibleApproves$=this.allApproves$.pipe((0,M.v)(this.page$,this.size$,this.queryForm.valueChanges.pipe((0,U.B)(400))),(0,U.B)(0),(0,B.T)(([u,I,L,j])=>{const D=j.token.split(" ").join(""),W=j.spender.split(" ").join("");if(D||W)return u.filter(w=>{const N=w.spender.toLowerCase().includes(W.toLowerCase()),it=w.token?.symbol.toLowerCase().includes(D.toLowerCase())||w.tokenAddress.toLowerCase().includes(D.toLowerCase());return N&&it});const z=I*L,nt=z+L;return u.filter((w,N)=>N>=z&&N<nt)}),(0,Q.u)()),this.visibleApproves$.subscribe()}fetchTransactions(i,c,h){return this.httpService.get({[s.BLOCKCHAIN_NAME.ETHEREUM]:`https://api.etherscan.io/api?module=account&action=txlist&address=${c}`,[s.BLOCKCHAIN_NAME.BINANCE_SMART_CHAIN]:`https://api.bscscan.com/api?module=account&action=txlist&address=${c}`,[s.BLOCKCHAIN_NAME.POLYGON]:`https://api.polygonscan.com/api?module=account&action=txlist&address=${c}`,[s.BLOCKCHAIN_NAME.ARBITRUM]:`https://api.arbiscan.io/api?module=account&action=txlist&address=${c}`,[s.BLOCKCHAIN_NAME.OPTIMISM]:`https://api-optimistic.etherscan.io/api?module=account&action=txlist&address=${c}`,[s.BLOCKCHAIN_NAME.FANTOM]:`https://api.ftmscan.com/api?module=account&action=txlist&address=${c}`,[s.BLOCKCHAIN_NAME.AVALANCHE]:`https://api.snowtrace.io/api?module=account&action=txlist&address=${c}`}[i.key]).pipe((0,B.T)(a=>this.handleScannerResponse(a)),(0,Z.AO)(()=>this.tokensStoreService.tokens$.pipe((0,J.$)(q.Aj))),(0,b.n)(a=>this.findTokensForApproves(a)),(0,b.n)(a=>this.fetchLastAllowance(a,i)),(0,B.T)(a=>a.filter(m=>"0"!==m.value)),(0,V.M)(()=>this._exceededLimits$.next(!1)),(0,Y.W)(a=>(a instanceof Error&&a.message.includes("Exceed limits")&&this._exceededLimits$.next(!0),(0,T.of)([]))))}revokeApprove(i,c){var h=this;return(0,v.A)(function*(){const d=h.form.controls.blockchain.value.key,a=s.Injector.web3PublicService.getWeb3Public(d);let m;if((yield a.getAllowance(i,h.walletConnectorService.address,c)).eq(0))throw new s.RubicSdkError("Approve already revoked, token has 0 allowance");try{const{shouldCalculateGasPrice:y,gasPriceOptions:u}=yield h.gasService.getGasInfo(d);yield s.Injector.web3PrivateService.getWeb3PrivateByBlockchain(d).approveTokens(i,c,new p.A(0),d,{onTransactionHash:I=>{m=h.showProgressNotification()},...y&&{gasPriceOptions:u}}),h.showSuccessNotification(),h._refreshTable$.next(i)}catch(y){h.handleError(y)}finally{m?.unsubscribe()}})()}showProgressNotification(){return this.notificationsService.show(this.translateService.instant("Revoke in progress"),{status:l.wS.Info,autoClose:!1,data:null,icon:"",defaultAutoCloseTime:0})}showSuccessNotification(){return this.notificationsService.show("Successful revoke",{status:l.wS.Success,autoClose:1e4,data:null,icon:"",defaultAutoCloseTime:0})}handleError(i){if(i instanceof Error){let c,h;i instanceof s.UserRejectError?(c=this.translateService.instant("errors.userReject"),h=l.wS.Error):(c=this.translateService.instant("errors.unknown"),h=l.wS.Error),this.notificationsService.show(c,{autoClose:1e4,status:h,data:null,icon:"",defaultAutoCloseTime:0})}}handleScannerResponse(i){if("string"==typeof i.result)throw new Error("Exceed limits");const c=i.result.filter(d=>d?.functionName.includes("approve")).reverse(),h=new Map;return c.forEach(d=>{const a=s.MethodDecoder.decodeMethod(s.ERC20_TOKEN_ABI.find(u=>"approve"===u.name),d.input),m=a.params.find(u=>"_spender"===u.name).value,E=a.params.find(u=>"_value"===u.name).value,y=`${d.to}${m}`;h.has(y)||h.set(y,{hash:d.hash,tokenAddress:d.to,spender:m,value:E,timeStamp:1e3*d.timeStamp})}),Array.from(h.values())}findTokensForApproves(i){const c=i.map(a=>a.tokenAddress),d=Array.from(new Set(c)).map(a=>this.tokensService.findToken({address:a,blockchain:this.form.controls.blockchain.value.key},!0));return(0,K.p)([(0,T.of)(i),Promise.all(d)]).pipe((0,B.T)(([a,m])=>a.map(E=>({...E,token:m.find(y=>(0,s.compareAddresses)(y?.address,E.tokenAddress))}))))}fetchLastAllowance(i,c){var h=this;return(0,v.A)(function*(){const a=yield s.Injector.web3PublicService.getWeb3Public(c.key).multicallContractsMethods(s.ERC20_TOKEN_ABI,i.map(m=>({contractAddress:m.tokenAddress,methodsData:[{methodName:"allowance",methodArguments:[h.walletConnectorService.address,m.spender]}]})));return i.map((m,E)=>({...m,value:a[E]?.[0].success?a[E][0].output:m.value}))})()}static#t=this.\u0275fac=function(c){return new(c||$)(f.KVO(H.c),f.KVO(tt.Qq),f.KVO(f.duS),f.KVO(O.m),f.KVO(_.p),f.KVO(et.I),f.KVO(st.c$),f.KVO(X.R))};static#e=this.\u0275prov=f.jDH({token:$,factory:$.\u0275fac})}(0,A.__decorate)([(0,G.R)({maxAge:12e4}),(0,A.__metadata)("design:type",Function),(0,A.__metadata)("design:paramtypes",[Object,String,String]),(0,A.__metadata)("design:returntype",R.c)],$.prototype,"fetchTransactions",null)},68247:(x,P,t)=>{t.d(P,{i:()=>s});var v=t(55748),f=t(76006),S=t(97119);const s=Object.fromEntries(Object.values(v.BLOCKCHAIN_NAME).map(g=>[g,{key:g,name:f.Z[g],img:S._[g]}]))},44455:(x,P,t)=>{t.d(P,{B:()=>S});var v=t(17705),A=t(93359),f=t(93679);let S=(()=>{class s{set decimals(e){this._decimals=e,setTimeout(()=>this.onChange())}constructor(e){this.elementRef=e,this.amountChange=new v.bkB,this.amountRegex=/^([0-9]+\.?[0-9]*|[0-9]*\.?[0-9]+)?$/,this.prevValue="",this.prevCaretPosition=0,this.isFocused=!1}onChange(){const e=this.elementRef.nativeElement.value||"";let n=e.replaceAll(",",""),r=this.elementRef.nativeElement.selectionStart;e&&","===e[e.length-1]&&(n+="."),"."===n&&(""===this.prevValue?(n="0.",r=2):(n="",r=0)),this.amountRegex.test(n)?(n=s.transformValue(n,this._decimals),r=n===this.prevValue?this.prevCaretPosition:this.getNewCaretPosition(n,r)):(n=this.prevValue,r=this.prevCaretPosition),this.elementRef.nativeElement.value=n,this.isFocused&&this.elementRef.nativeElement.setSelectionRange(r,r),this.amountChange.emit(n),this.prevValue=n,this.prevCaretPosition=r}static transformValue(e,n){if(e.includes(".")){const M=e.indexOf(".")+1;e=e.slice(0,M+n)}const[r,C]=e.split(".");return r.length&&(e=new A.A(r).toFormat(f.Z)+(e.includes(".")?".":"")+(C||"")),e}getNewCaretPosition(e,n){const C=this.prevValue.substring(0,n-(this.prevValue.length<e.length?1:0)).split(",").length-1;let b=n+(e.substring(0,n).split(",").length-1-C);return b&&e.length&&","===e[b-1]&&b--,b}onCaretPositionChange(){this.prevCaretPosition=this.elementRef.nativeElement.selectionStart}onFocus(){this.isFocused=!0}onFocusOut(){this.isFocused=!1}static#t=this.\u0275fac=function(n){return new(n||s)(v.rXU(v.aKT))};static#e=this.\u0275dir=v.FsC({type:s,selectors:[["","appTokenAmount",""]],hostBindings:function(n,r){1&n&&v.bIt("ngModelChange",function(){return r.onChange()})("keyup",function(){return r.onCaretPositionChange()})("click",function(){return r.onCaretPositionChange()})("focus",function(){return r.onFocus()})("focusout",function(){return r.onFocusOut()})},inputs:{decimals:"decimals"},outputs:{amountChange:"amountChange"}})}return s})()},40204:(x,P,t)=>{t.d(P,{g:()=>H});var v=t(74523),A=t(84412),f=t(25558),S=t(7673),s=t(88141),g=t(40800),e=t(17705),n=t(13711),r=t(73955);let C=(()=>{class l{constructor(o){this.context=o,this.points=o.data.points}ngAfterViewInit(){l.toggleConfettiBackground("show")}ngOnDestroy(){l.toggleConfettiBackground("remove")}static toggleConfettiBackground(o){const p=document.querySelector(".t-overlay");"show"===o&&p.classList.add("t-overlay-it-confetti"),"remove"===o&&p.classList.remove("t-overlay-it-confetti")}onConfirm(){this.context.completeWith(null)}static#t=this.\u0275fac=function(p){return new(p||l)(e.rXU(g.su))};static#e=this.\u0275cmp=e.VBU({type:l,selectors:[["polymorpheus-success-withdraw-modal"]],decls:20,vars:5,consts:[[1,"modal",3,"id"],[1,"modal__content"],[1,"modal__body"],["src","assets/images/swap-and-earn/it-mouse.svg","alt","Mouse",1,"modal__success-image"],[1,"modal__point-subtitle"],[1,"modal__point-subtitle_green"],[1,"modal__footer"],["fullWidth","","appearance","primary",3,"click"]],template:function(p,O){1&p&&(e.j41(0,"div",0)(1,"div",1)(2,"main",2),e.nrm(3,"img",3),e.j41(4,"span",4)(5,"span",5),e.EFF(6),e.k0s(),e.EFF(7," are requested to withdraw."),e.nrm(8,"br")(9,"br"),e.j41(10,"span"),e.EFF(11,"You can get your RBC through the Airdrop Claim twice a week. We\u2019ll share the Claim Link soon."),e.k0s(),e.nrm(12,"br")(13,"br"),e.j41(14,"span"),e.EFF(15,"Follow our socials to not miss out!"),e.k0s()()(),e.j41(16,"footer",6)(17,"app-rubic-button",7),e.bIt("click",function(){return O.onConfirm()}),e.EFF(18),e.nI1(19,"translate"),e.k0s()()()()),2&p&&(e.Y8G("id","gtm-transaction-modal"),e.R7$(6),e.SpI("",O.points," RBC"),e.R7$(12),e.SpI(" ",e.bMT(19,3,"common.OK")," "))},dependencies:[n.l,r.D9],styles:["[_ngcontent-%COMP%]:root{--app-background: #282935;--primary-background: var(--tui-base-01);--secondary-background: var(--tui-secondary);--dropdpwn-background: rgba(60, 61, 68, .85);--io-background: #222331;--tui-primary: #d1384d;--tui-primary-hover: #e42f47;--tui-primary-active: #e42f47;--tui-primary-text: #ffffff;--tui-secondary: #3b3d4f;--tui-secondary-hover: #4c4e67;--tui-secondary-active: #4c4e67;--tui-elevation-01: var(--tui-secondary);--tui-elevation-02: var(--tui-secondary);--tui-clear: var(--primary-background);--tui-link: white;--tui-link-hover: white;--tui-warn: #cfa200;--tui-base-01: #2c2d3e;--tui-base-02: #2c2d3e;--tui-base-03: #2c2d3e;--tui-base-04: #4d4d59;--tui-text-01: white;--tui-text-02: #9a9ab0;--tui-text-03: #9a9ab0;--tui-padding-xs: .25rem;--tui-padding-s: .5rem;--tui-padding-xl: 1.25rem;--tui-padding-4xl: 2rem;--tui-disabled-opacity: .5;--tui-radius-l: 17px;--tui-radius-m: 17px;--tui-radius-s: 12px}.highlight_green[_ngcontent-%COMP%]{color:var(--primary-color);cursor:pointer}.modal__content[_ngcontent-%COMP%]{padding:44px 20px;text-align:center}.modal__title[_ngcontent-%COMP%]{margin:30px auto 40px;font-size:25px;line-height:30px}.modal__title-points[_ngcontent-%COMP%]{margin:30px auto 19px;color:var(--primary-color)}.modal__point-subtitle[_ngcontent-%COMP%]{display:block;max-width:262px;margin:0 auto 17px;font-size:16px;line-height:120%;letter-spacing:.03em}.modal__footer-text[_ngcontent-%COMP%]{line-height:1.3}.modal__footer-text_warning[_ngcontent-%COMP%]{color:#d6bd27}.modal__footer-link[_ngcontent-%COMP%]{display:inline-block;font-size:17px;line-height:1.3;cursor:pointer}.modal[_ngcontent-%COMP%]   app-rubic-button[_ngcontent-%COMP%]{display:block;margin-top:25px}  .modal__content{padding:20px!important}.modal__point-subtitle[_ngcontent-%COMP%]{max-width:91%;line-height:160%}.modal__point-subtitle_green[_ngcontent-%COMP%]{color:#00e28e}.modal__footer[_ngcontent-%COMP%]{margin-bottom:25px}"],changeDetection:0})}return l})();var M=t(35763),b=t(67337),B=t(33390),T=t(16094);let K=(()=>{class l{constructor(o){this.httpService=o}fetchAirdropUserPointsInfo(o){return o?this.httpService.get(`rewards/?address=${o}`):(0,S.of)({confirmed:0,pending:0})}static#t=this.\u0275fac=function(p){return new(p||l)(e.KVO(b.k))};static#e=this.\u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var R=t(36719);let H=(()=>{class l{constructor(o,p,O,k,F){this.httpService=o,this.dialogService=p,this.walletConnectorService=O,this.apiService=k,this.authService=F,this.defaultPoints={confirmed:0,pending:0},this._fetchUserPointsInfoLoading$=new A.t(!1),this.fetchUserPointsInfoLoading$=this._fetchUserPointsInfoLoading$.asObservable(),this._points$=new A.t(this.defaultPoints),this.points$=this._points$.asObservable(),this._pointsAmount$=new A.t(0),this.pointsAmount$=this._pointsAmount$.asObservable(),this.handleAddressChange()}updateSwapToEarnUserPointsInfo(){this._fetchUserPointsInfoLoading$.next(!0),this.authService.currentUser$.pipe((0,f.n)(o=>this.apiService.fetchAirdropUserPointsInfo(o?.address)),(0,s.M)(o=>{this._points$.next(o),this._fetchUserPointsInfoLoading$.next(!1)})).subscribe()}claimPoints(o,p){var O=this;return(0,v.A)(function*(){p&&(O.httpService.post(`rewards/withdraw/?address=${p}`).subscribe(()=>O.updateSwapToEarnUserPointsInfo()),O.dialogService.showDialog(C,{data:{points:o}}).subscribe())})()}handleAddressChange(){this.walletConnectorService.addressChange$.pipe((0,M.n)(Boolean,o=>this.apiService.fetchAirdropUserPointsInfo(o),()=>(0,S.of)(this.defaultPoints))).subscribe(o=>{this._points$.next(o)})}static#t=this.\u0275fac=function(p){return new(p||l)(e.KVO(b.k),e.KVO(B.B),e.KVO(T.c),e.KVO(K),e.KVO(R.u))};static#e=this.\u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})()}}]);